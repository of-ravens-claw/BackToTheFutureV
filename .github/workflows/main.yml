name: BTTFV-WIP
# Hardcoded mess, but it works, okay?

on:
  push:
    branches: [ dev ]
  pull_request:

env:
  # WEBHOOK_URL: https://canary.discord.com/api/webhooks/1104236974761586808/l0eXPqDzX4O9FSaQp_UKgdYdKdPVTCoTFrx8B1utSX79Lr3cGUdER2TG1IHqJBxC24FV
  # For compatibility sake.
  # I'll do this properly later....
  GTAPath: D:/a/bttfv-actions-data/

jobs:
  build:
    runs-on: windows-latest

    steps:
    # This is an awful hack but C'est la vie...
    - name: Clone required libraries and set GTAPath for build. *THIS IS A HACK!*
      run: |
        cd "D:/a/"
        git clone https://github.com/audiorobscrackshack/bttfv-actions-data.git
        echo "GTAPath=D:/a/bttfv-actions-data/" >> $GITHUB_ENV
        cd "D:\a\BackToTheFutureV\BackToTheFutureV"

    - name: Checkout code
      uses: actions/checkout@v2
      with:
        submodules: recursive

    # wdym sometimes it works???? fucking nuget is awful i swear...
    # just make an empty commit called 'rebuild' if that happens.
    - name: Setup MSBuild
      uses: microsoft/setup-msbuild@v1.3.1

    - name: Restore NuGet packages
      run: nuget restore BackToTheFutureV.sln

    - name: Build solution - Release
      run: msbuild BackToTheFutureV.sln /p:Configuration=Release /verbosity:minimal

    - name: Build solution - Debug
      run: msbuild BackToTheFutureV.sln /p:Configuration=Debug /verbosity:minimal

    - name: Upload build artifact - Release
      uses: actions/upload-artifact@v2
      with:
        name: BackToTheFutureV - Release
        path: D:/a/BackToTheFutureV/BackToTheFutureV/BackToTheFutureV/bin/Release

    - name: Upload build artifact - Debug
      uses: actions/upload-artifact@v2
      with:
        name: BackToTheFutureV - Debug
        path: D:/a/BackToTheFutureV/BackToTheFutureV/BackToTheFutureV/bin/Debug

